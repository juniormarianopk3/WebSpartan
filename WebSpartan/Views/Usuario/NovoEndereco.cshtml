@model WebSpartan.Models.UserAddress
@{
    ViewData["Title"] = "Cadastrar Endereço";
}

<div class="container py-4">
    <h2 class="mb-3 text-center">@ViewData["Title"]</h2>

    <form asp-action="NovoEndereco" method="post" class="row g-3">
        <div class="col-md-3">
            <label asp-for="Cep" class="form-label"></label>
            <input asp-for="Cep" class="form-control" id="Cep" />
            <span asp-validation-for="Cep" class="text-danger"></span>
        </div>

        <div class="col-md-6">
            <label asp-for="Rua" class="form-label"></label>
            <input asp-for="Rua" class="form-control" id="Rua" />
        </div>

        <div class="col-md-3">
            <label asp-for="Numero" class="form-label"></label>
            <input asp-for="Numero" class="form-control" id="Numero" />
        </div>

        <div class="col-md-6">
            <label asp-for="Bairro" class="form-label"></label>
            <input asp-for="Bairro" class="form-control" id="Bairro" />
        </div>

        <div class="col-md-4">
            <label asp-for="Cidade" class="form-label"></label>
            <input asp-for="Cidade" class="form-control" id="Cidade" />
        </div>

        <div class="col-md-2">
            <label asp-for="Estado" class="form-label"></label>
            <select asp-for="Estado" class="form-select" id="Estado">
                <option value="">Selecione</option>
                <option value="AC">AC</option>
                <option value="AL">AL</option>
                <option value="AP">AP</option>
                <option value="AM">AM</option>
                <option value="BA">BA</option>
                <option value="CE">CE</option>
                <option value="DF">DF</option>
                <option value="ES">ES</option>
                <option value="GO">GO</option>
                <option value="MA">MA</option>
                <option value="MT">MT</option>
                <option value="MS">MS</option>
                <option value="MG">MG</option>
                <option value="PA">PA</option>
                <option value="PB">PB</option>
                <option value="PR">PR</option>
                <option value="PE">PE</option>
                <option value="PI">PI</option>
                <option value="RJ">RJ</option>
                <option value="RN">RN</option>
                <option value="RS">RS</option>
                <option value="RO">RO</option>
                <option value="RR">RR</option>
                <option value="SC">SC</option>
                <option value="SP">SP</option>
                <option value="SE">SE</option>
                <option value="TO">TO</option>
            </select>
            <span asp-validation-for="Estado" class="text-danger"></span>
        </div>

        <div class="col-md-12">
            <label asp-for="Complemento" class="form-label"></label>
            <input asp-for="Complemento" class="form-control" />
        </div>

        <div class="col-md-12 form-check">
            <input asp-for="Principal" class="form-check-input" />
            <label asp-for="Principal" class="form-check-label">Definir como principal</label>
        </div>

        <div class="col-12 text-center mt-3">
            <button type="submit" class="btn btn-primary">Salvar</button>
            <a asp-action="Enderecos" class="btn btn-secondary">Voltar</a>
        </div>
    </form>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />

    <!-- Máscara para CEP (opcional, mas deixa bonitinho) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.mask/1.14.16/jquery.mask.min.js"></script>

    <script>
        $(function () {

            // Máscara do CEP
            $('#Cep').mask('00000-000');

            // Ao perder o foco do campo CEP
            $('#Cep').on('blur', function () {
                var cep = $(this).val().replace(/\D/g, '');

                if (cep.length !== 8) {
                    // limpa campos se CEP for incompleto
                    $('#Rua').val('');
                    $('#Bairro').val('');
                    $('#Cidade').val('');
                    $('#Estado').val('');
                    return;
                }

                // Chama ViaCEP
                $.getJSON('https://viacep.com.br/ws/' + cep + '/json/', function (data) {
                    if (!data.erro) {
                        $('#Rua').val(data.logradouro);
                        $('#Bairro').val(data.bairro);
                        $('#Cidade').val(data.localidade);
                        $('#Estado').val(data.uf);
                        $('#Numero').focus(); // já joga o foco pro número
                    } else {
                        alert('CEP não encontrado.');
                        $('#Rua').val('');
                        $('#Bairro').val('');
                        $('#Cidade').val('');
                        $('#Estado').val('');
                    }
                }).fail(function () {
                    alert('Erro ao consultar o CEP.');
                });
            });
        });
    </script>
}
